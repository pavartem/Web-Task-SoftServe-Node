<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <title>Album example Â· Bootstrap</title>
    <link rel="stylesheet" href="bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
    <nav class="navbar fixed-top navbar-expand-lg bg-dark-blue py-0">

        <button class="navbar-toggler navbar-dark" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ">
                <li class="nav-item active">
                    <a class="nav-link p-0" href="index.html">Main <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle p-0" data-toggle="dropdown" href="#" role="button"
                       aria-haspopup="true" aria-expanded="false">Matches</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item py-3" href="calendar.html">Calendar of matches</a>
                        <a class="dropdown-item py-3" href="#">Next game</a>
                        <a class="dropdown-item py-3" href="#">Raiting</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link p-0" href="news.html">News</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link p-0" href="fans.html">Fans</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link p-0" href="contacts.html">Contacts</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link p-0" href="admin.html">Admin</a>
                </li>
            </ul>
        </div>
        <img src="img/logo.png" class="rotate-center" height="40" alt="">
    </nav>
</header>

<main role="main">
    <div class="container">
        <h2 class="pt-4">Appeal of fans</h2>
        <div id="appeals">
            <div class="comment py-4 border-bottom">
                <p>
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit. Asperiores autem beatae commodi ea esse
                    explicabo fuga, illum itaque modi quibusdam quidem rem repellendus, reprehenderit, ut vel. Corporis
                    culpa mollitia sunt.
                </p>
                <span>29.07.2019</span> <b class="float-right">user228</b>
            </div>
            <div class="comment py-4 border-bottom">
                <p>
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit. Asperiores autem beatae commodi ea esse
                    explicabo fuga, illum itaque modi quibusdam quidem rem repellendus, reprehenderit, ut vel. Corporis
                    culpa mollitia sunt.
                </p>
                <span>29.07.2019</span> <b class="float-right">user228</b>
            </div>
            <div class="comment py-4 border-bottom">
                <p>
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit. Asperiores autem beatae commodi ea esse
                    explicabo fuga, illum itaque modi quibusdam quidem rem repellendus, reprehenderit, ut vel. Corporis
                    culpa mollitia sunt.
                </p>
                <span>29.07.2019</span> <b class="float-right">user228</b>
            </div>
        </div>
        <div class="alert-danger p-2 col-md-4 d-none" id='alert'></div>
        <label for="username" class="mt-3">Username:</label>
        <input type="text" class="form-control col-md-3" id='username'>
        <div class="row comment-form py-4">
            <textarea class="form-control col-md-6" cols="30" rows="10" placeholder="Write an appeal" id='textarea'></textarea>
            <div class="col-md-6 d-flex align-items-end">
                <button id="submit-btn" class="btn btn-primary btn-lg mt-3 mt-lg-0">Send</button>
            </div>
            <button id='clear' class="btn mt-2 mt-md-0 btn-danger my-2 mt-2">Clear</button>
        </div>
    </div>
</main>

<footer class="bg-dark-blue" style="position:relative; bottom: 0;">
    <div class="container d-flex justify-content-center align-items-center">
        <div class="soc-bloc align-self-center">
            <a class="p-2" href=""><img height="25" src="./img/facebook.png" alt=""></a>
            <a class="p-2" href=""><img height="25" src="./img/instagram.png" alt=""></a>
            <a class="p-2" href=""><img height="25" src="./img/twitter.png" alt=""></a>
        </div>
    </div>
</footer>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

<script>
    


    const createAppealBlock = () => {
        const appealBlock = document.createElement('div');
        appealBlock.classList.add('comment','py-4','border-bottom');
        return appealBlock;
    }

    const createAppealText = (text) => {
        const childText = document.createElement('p');
        childText.innerHTML = text;
        return childText;
    }

    const createAppealDate = (date) => {
        const appealDate = document.createElement('span');
        appealDate.innerText = date;
        return appealDate;
    }

    const createAppealUser = (user) => {
        const appealAuthor = document.createElement('b');
        appealAuthor.innerText = user;
        appealAuthor.classList.add('float-right');
        return appealAuthor;

    }

    const combineAppealData = (appealBlock, text, date, user) => {
        appealBlock.appendChild(text);
        appealBlock.appendChild(date);
        appealBlock.appendChild(user);
        appeals.appendChild(appealBlock);
    }

    const getDate = () => {
        var today = new Date();
        var dd = String(today.getDate()).padStart(2, '0');
        var mm = String(today.getMonth() + 1).padStart(2, '0');
        var yyyy = today.getFullYear();

        today = dd + '.' + mm + '.' + yyyy;
        return today;
    }

    const getUsername = () => {
        if (username.value != ''){
            showAlert();
            return username.value;
        }
        showAlert('Username is empty');
    }

    const showAlert = (error) => {
        alert.innerText = error;
        alert.classList.remove('d-none');
    }
    
    const hideAlert = () => {
        alert.classList.add('d-none');
    }

    const validate = () => {
        if (username.value != '' && textarea.value != '' && username.value.trim() !== '' && textarea.value.trim() !== '')
        {
            hideAlert();
            return true;
        }
        showAlert('Input is incorrect');
        return false;
    }

    const clearInputs = () => {
        textarea.value = '';
        username.value = '';
    }
    const isOnline = () => {
        return window.navigator.onLine;
    }

    let appealsStorage = JSON.parse(localStorage.getItem('appeals')) || [];

    const button = document.getElementById('submit-btn');
    const appeals = document.getElementById('appeals');
    const textarea = document.getElementById('textarea');
    const username = document.getElementById('username');
    const alert = document.getElementById('alert');

    const createAppealData = () => {
        if (isOnline()){
            console.log('Call to server');
        } else {
            const appeal = {text: textarea.value, date: getDate(), user: username.value}
            appealsStorage.push(appeal);
            localStorage.setItem('appeals', JSON.stringify(appealsStorage));
        }
        if (validate()) {
            clearInputs();
        }
    }

    button.onclick = () => createAppealData();

    const createAppeal = (item) => {
        const appealBlock = createAppealBlock();
        const text = createAppealText(item.text);
        const date = createAppealDate(item.date);
        const user = createAppealUser(item.user);
        combineAppealData(appealBlock, text, date, user);
    }

    const appealsData = JSON.parse(localStorage.getItem('appeals')) || [];


    if(isOnline()) {
        appealsData.map((item) => createAppeal(item));
    }

    const clear = document.getElementById('clear');
    clear.onclick = () => localStorage.removeItem('appeals');

</script>
</body>
</html>
